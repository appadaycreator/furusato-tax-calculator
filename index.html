<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãµã‚‹ã•ã¨ç´ç¨é™åº¦é¡è¨ˆç®—ãƒ„ãƒ¼ãƒ« | 30æ—¥é€£ç¶šé–‹ç™ºãƒãƒ£ãƒ¬ãƒ³ã‚¸</title>
    <meta name="description" content="å¹´åã‹ã‚‰1ã‚¯ãƒªãƒƒã‚¯ã§ãµã‚‹ã•ã¨ç´ç¨ã®é™åº¦é¡ã‚’è¨ˆç®—ï¼ç¨åˆ¶ã«åŸºã¥ã„ãŸæ­£ç¢ºãªè¨ˆç®—ã§ã€æã—ãªã„ãµã‚‹ã•ã¨ç´ç¨ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚">
    <meta name="keywords" content="ãµã‚‹ã•ã¨ç´ç¨,é™åº¦é¡,è¨ˆç®—,ç¨é‡‘,æ§é™¤,ç¯€ç¨">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://appadaycreator.github.io/furusato-tax-calculator/">
    <meta property="og:title" content="ãµã‚‹ã•ã¨ç´ç¨é™åº¦é¡è¨ˆç®—ãƒ„ãƒ¼ãƒ«">
    <meta property="og:description" content="å¹´åã‹ã‚‰1ã‚¯ãƒªãƒƒã‚¯ã§ãµã‚‹ã•ã¨ç´ç¨ã®é™åº¦é¡ã‚’è¨ˆç®—ï¼">
    <meta property="og:image" content="https://appadaycreator.github.io/furusato-tax-calculator/og-image.jpg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://appadaycreator.github.io/furusato-tax-calculator/">
    <meta property="twitter:title" content="ãµã‚‹ã•ã¨ç´ç¨é™åº¦é¡è¨ˆç®—ãƒ„ãƒ¼ãƒ«">
    <meta property="twitter:description" content="å¹´åã‹ã‚‰1ã‚¯ãƒªãƒƒã‚¯ã§ãµã‚‹ã•ã¨ç´ç¨ã®é™åº¦é¡ã‚’è¨ˆç®—ï¼">
    <meta property="twitter:image" content="https://appadaycreator.github.io/furusato-tax-calculator/og-image.jpg">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ›ï¸</text></svg>">
    
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TXQGZRF9');</script>
    <!-- End Google Tag Manager -->

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .calculator-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 1rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
            transform: scale(1.2);
        }

        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .result-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            display: none;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 500;
        }

        .result-value {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .affiliate-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            text-align: center;
        }

        .affiliate-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }

        .affiliate-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .affiliate-btn {
            display: inline-block;
            padding: 12px 20px;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 2px solid;
        }

        .satofull {
            background: #FF6B6B;
            color: white;
            border-color: #FF6B6B;
        }

        .rakuten {
            background: #BF0000;
            color: white;
            border-color: #BF0000;
        }

        .furunavi {
            background: #4ECDC4;
            color: white;
            border-color: #4ECDC4;
        }

        .affiliate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .note {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-top: 20px;
            border-radius: 0 10px 10px 0;
            font-size: 0.9rem;
            color: #666;
        }

        .history-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
        }

        .history-item {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .clear-history {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .clear-history:hover {
            background: #ff5252;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .calculator-card {
                padding: 20px;
            }

            .affiliate-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TXQGZRF9"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div class="container">
        <div class="header">
            <h1>ğŸ›ï¸ ãµã‚‹ã•ã¨ç´ç¨é™åº¦é¡è¨ˆç®—ãƒ„ãƒ¼ãƒ«</h1>
            <p>å¹´åã‹ã‚‰1ã‚¯ãƒªãƒƒã‚¯ã§æ­£ç¢ºãªé™åº¦é¡ã‚’è¨ˆç®—</p>
        </div>

        <div class="calculator-card">
            <form id="taxForm">
                <div class="form-group">
                    <label for="income">å¹´åï¼ˆä¸‡å††ï¼‰</label>
                    <input type="number" id="income" name="income" placeholder="ä¾‹: 500" required>
                </div>

                <div class="form-group">
                    <label for="family">å®¶æ—æ§‹æˆ</label>
                    <select id="family" name="family" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="single">ç‹¬èº«ãƒ»å…±åƒã</option>
                        <option value="married_working">å¤«å©¦å…±åƒã</option>
                        <option value="married_housewife">å¤«å©¦ï¼ˆé…å¶è€…æ§é™¤ã‚ã‚Šï¼‰</option>
                        <option value="married_child1">å¤«å©¦+å­1äººï¼ˆ19æ­³ä»¥ä¸‹ï¼‰</option>
                        <option value="married_child2">å¤«å©¦+å­2äººï¼ˆ19æ­³ä»¥ä¸‹ï¼‰</option>
                        <option value="married_college1">å¤«å©¦+å¤§å­¦ç”Ÿ1äºº</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="socialInsurance">ç¤¾ä¼šä¿é™ºæ–™æ§é™¤ï¼ˆä¸‡å††ï¼‰</label>
                    <input type="number" id="socialInsurance" name="socialInsurance" placeholder="ä¾‹: 70" value="0">
                </div>

                <div class="form-group">
                    <label for="lifeInsurance">ç”Ÿå‘½ä¿é™ºæ–™æ§é™¤ï¼ˆä¸‡å††ï¼‰</label>
                    <input type="number" id="lifeInsurance" name="lifeInsurance" placeholder="ä¾‹: 12" value="0">
                </div>

                <div class="form-group">
                    <label for="medicalExpense">åŒ»ç™‚è²»æ§é™¤ï¼ˆä¸‡å††ï¼‰</label>
                    <input type="number" id="medicalExpense" name="medicalExpense" placeholder="ä¾‹: 10" value="0">
                </div>

                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="housingLoan" name="housingLoan">
                        <label for="housingLoan">ä½å®…ãƒ­ãƒ¼ãƒ³æ§é™¤ã‚ã‚Š</label>
                    </div>
                </div>

                <button type="submit" class="calculate-btn">é™åº¦é¡ã‚’è¨ˆç®—ã™ã‚‹</button>
            </form>
        </div>

        <div id="result" class="result-card">
            <h3 style="margin-bottom: 20px; text-align: center;">è¨ˆç®—çµæœ</h3>
            <div class="result-item">
                <span class="result-label">ãµã‚‹ã•ã¨ç´ç¨é™åº¦é¡</span>
                <span class="result-value" id="taxLimit">0å††</span>
            </div>
            <div class="result-item">
                <span class="result-label">å®Ÿè³ªè² æ‹…é¡</span>
                <span class="result-value">2,000å††</span>
            </div>
            <div class="result-item">
                <span class="result-label">ãŠã™ã™ã‚å¯„ä»˜é¡</span>
                <span class="result-value" id="recommendAmount">0å††</span>
            </div>
        </div>

        <div class="note">
            <strong>âš ï¸ æ³¨æ„äº‹é …ï¼š</strong>
            ã“ã®è¨ˆç®—çµæœã¯æ¦‚ç®—ã§ã™ã€‚æ­£ç¢ºãªé™åº¦é¡ã¯ã€ç¢ºå®šç”³å‘Šã‚„ä½æ°‘ç¨ã®è¨ˆç®—ã«ã‚ˆã£ã¦æ±ºå®šã•ã‚Œã¾ã™ã€‚
            å¯„ä»˜å‰ã«å¿…ãšè‡ªæ²»ä½“ã‚„ç¨ç†å£«ã«ã”ç›¸è«‡ãã ã•ã„ã€‚
        </div>

        <div class="affiliate-section">
            <h3 class="affiliate-title">ğŸ’ ãŠã™ã™ã‚ãµã‚‹ã•ã¨ç´ç¨ã‚µã‚¤ãƒˆ</h3>
            <p>è¨ˆç®—ã—ãŸé™åº¦é¡ã§ãŠå¾—ãªè¿”ç¤¼å“ã‚’è¦‹ã¤ã‘ã‚ˆã†ï¼</p>
            <div class="affiliate-buttons">
                <a href="https://www.satofull.jp/" target="_blank" class="affiliate-btn satofull" rel="noopener">
                    ã•ã¨ãµã‚‹<br><small>è±Šå¯Œãªè¿”ç¤¼å“</small>
                </a>
                <a href="https://event.rakuten.co.jp/furusato/" target="_blank" class="affiliate-btn rakuten" rel="noopener">
                    æ¥½å¤©ãµã‚‹ã•ã¨ç´ç¨<br><small>æ¥½å¤©ãƒã‚¤ãƒ³ãƒˆé‚„å…ƒ</small>
                </a>
                <a href="https://furunavi.jp/" target="_blank" class="affiliate-btn furunavi" rel="noopener">
                    ãµã‚‹ãªã³<br><small>å®¶é›»ã‚‚å……å®Ÿ</small>
                </a>
            </div>
        </div>

        <div class="history-card">
            <h3 style="margin-bottom: 15px;">è¨ˆç®—å±¥æ­´</h3>
            <div id="historyList">
                <p style="color: #999; text-align: center;">ã¾ã è¨ˆç®—å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</p>
            </div>
            <button id="clearHistory" class="clear-history" style="display: none; margin-top: 15px;">å±¥æ­´ã‚’ã‚¯ãƒªã‚¢</button>
        </div>
    </div>

    <script>
        // ç¨ç‡ã¨æ§é™¤é¡ã®å®šç¾©
        const TAX_BRACKETS = [
            { min: 0, max: 1950000, rate: 0.05, deduction: 0 },
            { min: 1950000, max: 3300000, rate: 0.10, deduction: 97500 },
            { min: 3300000, max: 6950000, rate: 0.20, deduction: 427500 },
            { min: 6950000, max: 9000000, rate: 0.23, deduction: 636000 },
            { min: 9000000, max: 18000000, rate: 0.33, deduction: 1536000 },
            { min: 18000000, max: 40000000, rate: 0.40, deduction: 2796000 },
            { min: 40000000, max: Infinity, rate: 0.45, deduction: 4796000 }
        ];

        // å®¶æ—æ§‹æˆåˆ¥æ§é™¤é¡
        const FAMILY_DEDUCTIONS = {
            'single': 480000,
            'married_working': 480000,
            'married_housewife': 480000 + 380000,
            'married_child1': 480000 + 380000 + 380000,
            'married_child2': 480000 + 380000 + 380000 * 2,
            'married_college1': 480000 + 380000 + 630000
        };

        document.getElementById('taxForm').addEventListener('submit', function(e) {
            e.preventDefault();
            calculateTaxLimit();
        });

        function calculateTaxLimit() {
            const income = parseInt(document.getElementById('income').value) * 10000;
            const family = document.getElementById('family').value;
            const socialInsurance = parseInt(document.getElementById('socialInsurance').value || 0) * 10000;
            const lifeInsurance = parseInt(document.getElementById('lifeInsurance').value || 0) * 10000;
            const medicalExpense = parseInt(document.getElementById('medicalExpense').value || 0) * 10000;
            const housingLoan = document.getElementById('housingLoan').checked;

            if (!income || !family) {
                alert('å¹´åã¨å®¶æ—æ§‹æˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            // ç¤¾ä¼šä¿é™ºæ–™ã®æ¦‚ç®—ï¼ˆå¹´åã®ç´„14%ï¼‰
            const estimatedSocialInsurance = socialInsurance || income * 0.14;

            // æ‰€å¾—æ§é™¤ã®åˆè¨ˆ
            const basicDeduction = 480000; // åŸºç¤æ§é™¤
            const familyDeduction = FAMILY_DEDUCTIONS[family] - basicDeduction;
            const totalDeductions = basicDeduction + familyDeduction + estimatedSocialInsurance + 
                                  Math.min(lifeInsurance, 120000) + medicalExpense;

            // èª²ç¨æ‰€å¾—
            const taxableIncome = Math.max(0, income - totalDeductions);

            // æ‰€å¾—ç¨ã®è¨ˆç®—
            let incomeTax = 0;
            for (const bracket of TAX_BRACKETS) {
                if (taxableIncome > bracket.min) {
                    const taxableAmount = Math.min(taxableIncome, bracket.max) - bracket.min;
                    incomeTax = taxableAmount * bracket.rate - bracket.deduction;
                    break;
                }
            }

            // ä½æ°‘ç¨ï¼ˆèª²ç¨æ‰€å¾—ã®10%ï¼‰
            const residentTax = taxableIncome * 0.10;

            // ä½å®…ãƒ­ãƒ¼ãƒ³æ§é™¤ã®å½±éŸ¿ï¼ˆç°¡æ˜“è¨ˆç®—ï¼‰
            let adjustedIncomeTax = incomeTax;
            if (housingLoan) {
                adjustedIncomeTax = Math.max(0, incomeTax - income * 0.01); // æ¦‚ç®—1%æ¸›ç¨
            }

            // ãµã‚‹ã•ã¨ç´ç¨é™åº¦é¡ã®è¨ˆç®—
            // (å€‹äººä½æ°‘ç¨æ‰€å¾—å‰²é¡ Ã— 20%) Ã· (90% - æ‰€å¾—ç¨ç‡) + 2,000å††
            const taxRate = getTaxRate(taxableIncome);
            const limit = Math.floor((residentTax * 0.20) / (0.90 - taxRate) + 2000);

            // ãŠã™ã™ã‚å¯„ä»˜é¡ï¼ˆé™åº¦é¡ã®95%ï¼‰
            const recommendAmount = Math.floor(limit * 0.95);

            // çµæœè¡¨ç¤º
            document.getElementById('taxLimit').textContent = limit.toLocaleString() + 'å††';
            document.getElementById('recommendAmount').textContent = recommendAmount.toLocaleString() + 'å††';
            document.getElementById('result').style.display = 'block';

            // å±¥æ­´ã«è¿½åŠ 
            addToHistory(income / 10000, family, limit);

            // ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯è¿½è·¡
            trackAffiliateClicks(limit);

            // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
        }

        function getTaxRate(taxableIncome) {
            for (const bracket of TAX_BRACKETS) {
                if (taxableIncome > bracket.min && taxableIncome <= bracket.max) {
                    return bracket.rate;
                }
            }
            return 0.05; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
        }

        // localStorageä½¿ç”¨ç‰ˆï¼ˆGitHub Pagesç”¨ï¼‰
        function addToHistory(income, family, limit) {
            try {
                const history = JSON.parse(localStorage.getItem('furusatoHistory') || '[]');
                const familyNames = {
                    'single': 'ç‹¬èº«ãƒ»å…±åƒã',
                    'married_working': 'å¤«å©¦å…±åƒã',
                    'married_housewife': 'å¤«å©¦ï¼ˆé…å¶è€…æ§é™¤ã‚ã‚Šï¼‰',
                    'married_child1': 'å¤«å©¦+å­1äºº',
                    'married_child2': 'å¤«å©¦+å­2äºº',
                    'married_college1': 'å¤«å©¦+å¤§å­¦ç”Ÿ1äºº'
                };

                history.unshift({
                    date: new Date().toLocaleDateString(),
                    income: income,
                    family: familyNames[family],
                    limit: limit
                });

                // æœ€æ–°5ä»¶ã®ã¿ä¿æŒ
                if (history.length > 5) {
                    history.pop();
                }

                localStorage.setItem('furusatoHistory', JSON.stringify(history));
                displayHistory();
            } catch (error) {
                console.log('LocalStorage not available, using session storage');
                // localStorageãŒä½¿ç”¨ã§ããªã„å ´åˆã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­ã®ã¿ä¿å­˜
            }
        }

        function displayHistory() {
            try {
                const history = JSON.parse(localStorage.getItem('furusatoHistory') || '[]');
                const historyList = document.getElementById('historyList');
                const clearBtn = document.getElementById('clearHistory');

                if (history.length === 0) {
                    historyList.innerHTML = '<p style="color: #999; text-align: center;">ã¾ã è¨ˆç®—å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                    clearBtn.style.display = 'none';
                    return;
                }

                historyList.innerHTML = history.map(item => 
                    `<div class="history-item">
                        <div>
                            <strong>${item.date}</strong><br>
                            å¹´å${item.income}ä¸‡å†† (${item.family})
                        </div>
                        <div style="text-align: right;">
                            <strong>${item.limit.toLocaleString()}å††</strong>
                        </div>
                    </div>`
                ).join('');

                clearBtn.style.display = 'block';
            } catch (error) {
                console.log('LocalStorage not available');
            }
        }

        document.getElementById('clearHistory').addEventListener('click', function() {
            try {
                localStorage.removeItem('furusatoHistory');
                displayHistory();
            } catch (error) {
                console.log('LocalStorage not available');
            }
        });

        // ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆãƒªãƒ³ã‚¯è¿½è·¡
        function trackAffiliateClicks(calculatedAmount) {
            document.querySelectorAll('.affiliate-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Google Analyticsè¿½è·¡
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'affiliate_click', {
                            'affiliate_site': this.textContent.trim().split('\n')[0],
                            'calculation_amount': calculatedAmount,
                            'event_category': 'affiliate',
                            'event_label': 'furusato_site_click'
                        });
                    }
                });
            });
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å±¥æ­´ã‚’è¡¨ç¤º
        displayHistory();

        // å¹´åå…¥åŠ›æ™‚ã®è‡ªå‹•ç¤¾ä¼šä¿é™ºæ–™è¨ˆç®—
        document.getElementById('income').addEventListener('input', function() {
            const income = parseInt(this.value || 0);
            if (income > 0) {
                const estimatedSocialInsurance = Math.floor(income * 0.14);
                const socialInsuranceInput = document.getElementById('socialInsurance');
                if (socialInsuranceInput.value === '0' || socialInsuranceInput.value === '') {
                    socialInsuranceInput.value = estimatedSocialInsurance;
                }
            }
        });
    </script>
</body>
</html>